#!/bin/bash

function usage() {
  echo "body"
}

function get_body_without_head_and_tail() {
  if [[ ! -z "$hd" ]] && [[ ! -z "$tl" ]];then
    text="$(cat $1 | tail -n +`expr $hd + 1` | head -n -"$tl")"
  elif [[ -z "$hd" ]] && [[ ! -z "$tl" ]]; then
    text="$(cat $1 | tail -n +"$DEFAULT_REMOVE_LINE" | head -n -"$tl")"
  elif [[ ! -z "$hd" ]] && [[ -z "$tl" ]]; then
    text="$(cat $1 | tail -n +`expr $hd + 1` | head -n -"$DEFAULT_REMOVE_LINE")"
  else
    # default: remove each 10 lines 
    text="$(cat $1 | tail -n +"$DEFAULT_REMOVE_LINE" | head -n -"$DEFAULT_REMOVE_LINE")"
  fi
  echo "$text"
}

function get_body_from_center() {
  line_count="$(cat $1 | grep -c '')"
  center_line="$(expr $line_count / 2)"
  range=10
  if [[ ! -z "$line" ]];then
    range="$(expr $line / 2)"
    # even lines
    if [[ "$(expr $line_count % 2 )" -eq 0 ]]; then
      bf="$(expr $center_line - $range)"
      af="$(expr $center_line + $range)"
      text="$(cat $1 | head -"$af" | tail -`expr $af - $bf + 1`)"
    # odd lines
    elif [[ "$(expr $line_count % 2 )" -eq 1 ]]; then
      bf="$(expr $center_line - $range)"
      af="$(expr $center_line + $range + 1)"
      text="$(cat $1 | head -n "$af" | tail -n `expr $af - $bf`)"
    fi
  else
    bf="$(expr $center_line - $range)"
    af="$(expr $center_line + $range)"
    text="$(cat $1 | head -"$af" | tail -`expr $af - $bf + 1`)"
  fi
  echo "$text"
}

MODE=0
while getopts "h:t:n:" opts
do
  case $opts in
    h )
      hd="$OPTARG"
      MODE=1
      ;;
    t )
      tl="$OPTARG"
      MODE=1
      ;;
    n )
      line="$OPTARG"
      MODE=2
      ;;
    \?)
      exit 1
      ;;
  esac
done

shift $((OPTIND - 1))

DEFAULT_REMOVE_LINE=10

# main
case "$MODE" in
  1 )
    get_body_without_head_and_tail "$1"
    ;;
  2 )
    get_body_from_center "$1"
esac


